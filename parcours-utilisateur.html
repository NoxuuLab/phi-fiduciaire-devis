<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHI Fiduciaire - Parcours Utilisateur Devis</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #1e3a5f 0%, #2a4d7a 100%);
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 20px rgba(30, 58, 95, 0.3);
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .version {
            display: inline-block;
            background: #c9a961;
            color: #1e3a5f;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .diagram-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .diagram-section h2 {
            color: #1e3a5f;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #c9a961;
            font-size: 1.4rem;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            overflow-x: auto;
            padding: 1rem 0;
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .legend-text {
            font-size: 0.9rem;
            color: #333;
        }

        .color-step { background: #4a90d9; }
        .color-decision { background: #f39c12; }
        .color-result-green { background: #27ae60; }
        .color-result-orange { background: #e67e22; }
        .color-result-red { background: #e74c3c; }
        .color-creation { background: #9b59b6; }

        .formula-section {
            background: #1e3a5f;
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .formula-section h2 {
            color: #c9a961;
            margin-bottom: 1rem;
        }

        .formula-box {
            background: rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            text-align: center;
            margin: 1rem 0;
        }

        .guardrails {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .guardrail-card {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #c9a961;
        }

        .guardrail-card h4 {
            color: #c9a961;
            margin-bottom: 0.5rem;
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            header h1 {
                font-size: 1.5rem;
            }

            .diagram-section {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PHI Fiduciaire - Parcours Utilisateur</h1>
            <p>Diagramme UML du flux de devis</p>
            <span class="version">v4.0</span>
        </header>

        <!-- Formula Section -->
        <div class="formula-section">
            <h2>Formule de Calcul (Societe Existante)</h2>
            <div class="formula-box">
                Prix = BasePrice(CA) × (1.10 ^ nombre_employes)
            </div>
            <div class="guardrails">
                <div class="guardrail-card">
                    <h4>Guardrail Minimum</h4>
                    <p>1.5% du CA</p>
                    <p style="font-size: 0.85rem; opacity: 0.8; margin-top: 0.5rem;">En dessous → NOT_INTERESTING</p>
                </div>
                <div class="guardrail-card">
                    <h4>Guardrail Maximum</h4>
                    <p>3% du CA</p>
                    <p style="font-size: 0.85rem; opacity: 0.8; margin-top: 0.5rem;">Au dessus → ON_QUOTE</p>
                </div>
                <div class="guardrail-card">
                    <h4>Declencheurs Manuels</h4>
                    <p>CA > 800K ou Employes > 20</p>
                    <p style="font-size: 0.85rem; opacity: 0.8; margin-top: 0.5rem;">→ ON_QUOTE immediat</p>
                </div>
                <div class="guardrail-card">
                    <h4>Exceptions (0 employes)</h4>
                    <p>Skip min guardrail</p>
                    <p style="font-size: 0.85rem; opacity: 0.8; margin-top: 0.5rem;">+ CA ≤ 200K: skip max aussi</p>
                </div>
            </div>
        </div>

        <!-- Main Flow Diagram -->
        <div class="diagram-section">
            <h2>Flux Principal - Vue d'ensemble</h2>
            <div class="mermaid">
flowchart TB
    subgraph START["DEBUT"]
        A[("Visiteur arrive<br/>sur le formulaire")]
    end

    subgraph STEP1["ETAPE 1: Structure"]
        B{{"Quelle est votre<br/>structure juridique?"}}
        B1["Independant"]
        B2["Sarl existante"]
        B3["SA existante"]
        B4["Creation de societe"]
    end

    A --> B
    B --> B1 & B2 & B3 & B4

    B1 & B2 & B3 --> EXISTING_FLOW
    B4 --> CREATION_FLOW

    subgraph EXISTING_FLOW["FLUX SOCIETE EXISTANTE"]
        direction TB
        E1["Etape 4: Services<br/>(informatif)"]
        E2["Etape 5: Nombre<br/>d'employes"]
        E3["Etape 6: Chiffre<br/>d'affaires annuel"]
        E4["Etape 7: Coordonnees"]

        E1 --> E2 --> E3 --> E4
    end

    subgraph CREATION_FLOW["FLUX CREATION"]
        direction TB
        C1["Etape 2: Type<br/>Sarl ou SA"]
        C2["Etape 3: Situation<br/>(Risk add-ons)"]
        C3["Etape 4: Services<br/>(Domiciliation/Admin)"]
        C4["Etape 7: Coordonnees"]

        C1 --> C2 --> C3 --> C4
    end

    E4 --> CALC
    C4 --> RESULT_CREATION

    subgraph CALC["CALCUL PRIX"]
        direction TB
        CALC1{{"CA > 800K?"}}
        CALC2{{"Employes > 20?"}}
        CALC3["Calcul:<br/>Base × 1.10^emp"]
        CALC4{{"Prix dans<br/>guardrails?"}}
    end

    CALC1 -->|Oui| RESULT_QUOTE
    CALC1 -->|Non| CALC2
    CALC2 -->|Oui| RESULT_QUOTE
    CALC2 -->|Non| CALC3
    CALC3 --> CALC4
    CALC4 -->|"< 1.5%"| RESULT_NI
    CALC4 -->|"> 3%"| RESULT_QUOTE
    CALC4 -->|"1.5% - 3%"| RESULT_AUTO

    subgraph RESULTS["RESULTATS"]
        RESULT_AUTO(["AUTO_PRICED<br/>Prix affiche"])
        RESULT_NI(["NOT_INTERESTING<br/>Mandat non rentable"])
        RESULT_QUOTE(["ON_QUOTE<br/>Devis sur demande"])
        RESULT_CREATION(["CREATION<br/>Frais + Services"])
    end

    style START fill:#e8f4f8,stroke:#1e3a5f
    style STEP1 fill:#fff3cd,stroke:#f39c12
    style EXISTING_FLOW fill:#e3f2fd,stroke:#4a90d9
    style CREATION_FLOW fill:#f3e5f5,stroke:#9b59b6
    style CALC fill:#fff8e1,stroke:#f39c12
    style RESULTS fill:#e8f5e9,stroke:#27ae60

    style RESULT_AUTO fill:#27ae60,color:#fff,stroke:#1e8449
    style RESULT_NI fill:#e67e22,color:#fff,stroke:#d35400
    style RESULT_QUOTE fill:#e74c3c,color:#fff,stroke:#c0392b
    style RESULT_CREATION fill:#9b59b6,color:#fff,stroke:#7d3c98
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color color-step"></div>
                    <span class="legend-text">Etapes du formulaire</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-decision"></div>
                    <span class="legend-text">Points de decision</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-result-green"></div>
                    <span class="legend-text">AUTO_PRICED (prix calcule)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-result-orange"></div>
                    <span class="legend-text">NOT_INTERESTING (non rentable)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-result-red"></div>
                    <span class="legend-text">ON_QUOTE (devis manuel)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-creation"></div>
                    <span class="legend-text">Flux creation</span>
                </div>
            </div>
        </div>

        <!-- Detailed Existing Company Flow -->
        <div class="diagram-section">
            <h2>Detail - Flux Societe Existante</h2>
            <div class="mermaid">
flowchart LR
    subgraph INPUT["ENTREES"]
        I1["Structure:<br/>Independant/Sarl/SA"]
        I2["Services:<br/>Comptabilite, Fiscalite,<br/>RH, TVA (informatif)"]
        I3["Employes:<br/>0 - 20+"]
        I4["CA Annuel:<br/>0 - 800K+"]
    end

    subgraph TRIGGERS["VERIFICATION DECLENCHEURS"]
        T1{{"CA > 800K?"}}
        T2{{"Employes > 20?"}}
    end

    subgraph CALCULATION["CALCUL"]
        C1["1. Base Price<br/>interpolation CA"]
        C2["2. Multiplicateur<br/>1.10^employes"]
        C3["3. Prix = Base × Mult"]
        C4["4. % du CA"]
    end

    subgraph GUARDRAILS["GUARDRAILS"]
        G1{{"Prix < 1.5% CA?"}}
        G2{{"Prix > 3% CA?"}}
        G3{{"Exception<br/>0 employes?"}}
    end

    subgraph OUTPUT["SORTIE"]
        O1(["AUTO_PRICED"])
        O2(["NOT_INTERESTING"])
        O3(["ON_QUOTE"])
    end

    I1 --> I2 --> I3 --> I4
    I4 --> T1
    T1 -->|Oui| O3
    T1 -->|Non| T2
    T2 -->|Oui| O3
    T2 -->|Non| C1

    C1 --> C2 --> C3 --> C4
    C4 --> G1

    G1 -->|Oui| G3
    G1 -->|Non| G2
    G3 -->|"Oui (skip)"| O1
    G3 -->|Non| O2
    G2 -->|Oui| O3
    G2 -->|Non| O1

    style INPUT fill:#e3f2fd,stroke:#4a90d9
    style TRIGGERS fill:#ffebee,stroke:#e74c3c
    style CALCULATION fill:#fff8e1,stroke:#f39c12
    style GUARDRAILS fill:#f3e5f5,stroke:#9b59b6
    style OUTPUT fill:#e8f5e9,stroke:#27ae60

    style O1 fill:#27ae60,color:#fff
    style O2 fill:#e67e22,color:#fff
    style O3 fill:#e74c3c,color:#fff
            </div>
        </div>

        <!-- Creation Flow Detail -->
        <div class="diagram-section">
            <h2>Detail - Flux Creation de Societe</h2>
            <div class="mermaid">
flowchart LR
    subgraph TYPE["TYPE DE SOCIETE"]
        T1["Sarl<br/>750 CHF"]
        T2["SA<br/>1'150 CHF"]
    end

    subgraph RISK["RISK ADD-ONS (optionnel)"]
        R1["Assujetti TVA<br/>+600 CHF"]
        R2["Activite etranger<br/>+1'200 CHF"]
        R3["Structure holding<br/>+1'000 CHF"]
    end

    subgraph SERVICES["SERVICES (optionnel)"]
        S1["Domiciliation<br/>+3'000 CHF/an"]
        S2["Directeur Admin<br/>+9'500 CHF/an<br/>(SA uniquement)"]
    end

    subgraph RESULT["RESULTAT"]
        RES["Frais creation<br/>+ Services annuels"]
        NOTE["Note: Comptabilite,<br/>fiscalite, RH, TVA<br/>= devis separe"]
    end

    T1 & T2 --> RISK
    RISK --> SERVICES
    SERVICES --> RES
    RES -.-> NOTE

    style TYPE fill:#f3e5f5,stroke:#9b59b6
    style RISK fill:#fff3cd,stroke:#f39c12
    style SERVICES fill:#e3f2fd,stroke:#4a90d9
    style RESULT fill:#e8f5e9,stroke:#27ae60
            </div>
        </div>

        <!-- State Diagram -->
        <div class="diagram-section">
            <h2>Diagramme d'Etats - Statuts de Sortie</h2>
            <div class="mermaid">
stateDiagram-v2
    [*] --> Formulaire

    Formulaire --> Verification: Soumission

    state Verification {
        [*] --> CheckCA
        CheckCA --> ON_QUOTE_State: CA > 800K
        CheckCA --> CheckEmployees: CA <= 800K
        CheckEmployees --> ON_QUOTE_State: Emp > 20
        CheckEmployees --> Calcul: Emp <= 20
    }

    state Calcul {
        [*] --> BasePrice
        BasePrice --> Multiplier
        Multiplier --> Percentage
        Percentage --> CheckGuardrails
    }

    CheckGuardrails --> AUTO_PRICED_State: 1.5% <= Prix <= 3%
    CheckGuardrails --> NOT_INTERESTING_State: Prix < 1.5%
    CheckGuardrails --> ON_QUOTE_State: Prix > 3%

    state AUTO_PRICED_State {
        [*] --> DisplayPrice
        DisplayPrice --> ShowMonthly
        ShowMonthly --> ShowPercentage
    }

    state NOT_INTERESTING_State {
        [*] --> ShowWarning
        ShowWarning --> DisplayCalculation
        DisplayCalculation --> FlagForReview
    }

    state ON_QUOTE_State {
        [*] --> ShowMessage
        ShowMessage --> OptionalDetails
        OptionalDetails --> ContactPrompt
    }

    AUTO_PRICED_State --> [*]
    NOT_INTERESTING_State --> [*]
    ON_QUOTE_State --> [*]
            </div>
        </div>

        <!-- Pricing Table -->
        <div class="diagram-section">
            <h2>Table des Prix de Base (Interpolation)</h2>
            <div class="mermaid">
xychart-beta
    title "Prix de Base par Chiffre d'Affaires"
    x-axis [100K, 200K, 300K, 400K, 500K, 600K, 700K, 800K]
    y-axis "Prix (CHF)" 3000 --> 9000
    line [3600, 3960, 4356, 5500, 6050, 6655, 7321, 8053]
            </div>
            <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse; text-align: center;">
                    <thead>
                        <tr style="background: #1e3a5f; color: white;">
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">CA (CHF)</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">100K</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">200K</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">300K</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">400K</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">500K</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">600K</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">700K</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">800K</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 0.75rem; border: 1px solid #ddd; font-weight: 600; background: #c9a961; color: #1e3a5f;">Base Price</td>
                            <td style="padding: 0.75rem; border: 1px solid #ddd;">3'600</td>
                            <td style="padding: 0.75rem; border: 1px solid #ddd;">3'960</td>
                            <td style="padding: 0.75rem; border: 1px solid #ddd;">4'356</td>
                            <td style="padding: 0.75rem; border: 1px solid #ddd;">5'500</td>
                            <td style="padding: 0.75rem; border: 1px solid #ddd;">6'050</td>
                            <td style="padding: 0.75rem; border: 1px solid #ddd;">6'655</td>
                            <td style="padding: 0.75rem; border: 1px solid #ddd;">7'321</td>
                            <td style="padding: 0.75rem; border: 1px solid #ddd;">8'053</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Employee Multiplier -->
        <div class="diagram-section">
            <h2>Multiplicateur Employes (1.10^n)</h2>
            <div class="mermaid">
xychart-beta
    title "Impact du Nombre d'Employes sur le Prix"
    x-axis "Employes" [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    y-axis "Multiplicateur" 1 --> 3
    line [1.00, 1.10, 1.21, 1.33, 1.46, 1.61, 1.77, 1.95, 2.14, 2.36, 2.59]
            </div>
            <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; text-align: center;">
                <p><strong>Exemple:</strong> Base 5'000 CHF avec 5 employes = 5'000 × 1.61 = <strong>8'053 CHF</strong></p>
            </div>
        </div>

        <footer>
            <p>PHI Fiduciaire - Generateur de Devis v4.0</p>
            <p>Document genere le 3 fevrier 2026</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            securityLevel: 'loose'
        });
    </script>
</body>
</html>
